# ~/.config/fish/config.fish
# Generated by Chezmoi for {{ .chezmoi.os }}
# =========================
# Basic editor & colors
# =========================
set -gx EDITOR nvim
set -gx EZA_COLORS "da=34:di=34:ex=32:fi=0:ln=36:or=31:pi=33:so=35:su=31:tw=31"
set -gx STARSHIP_CONFIG "$HOME/.config/starship/starship.toml"

# ========================
# Trust the Chezmoi Vault in Mise
# =======================
set -gx MISE_TRUSTED_CONFIG_PATHS "{{ .chezmoi.sourceDir }}"

# =========================
# Homebrew (macOS Only)
# =========================
{{- if eq .chezmoi.os "darwin" }}
if test -x /opt/homebrew/bin/brew
    eval "$(/opt/homebrew/bin/brew shellenv)"
end

# Mac-specific Mise locations
set -gx MISE_DATA_DIR $HOME/.local/share/mise
set -gx MISE_CONFIG_DIR $HOME/.config/mise
set -gx MISE_CACHE_DIR $HOME/.cache/mise
{{- end }}

# =========================
# PATH setup
# =========================
# fish_add_path handles deduplication automatically
fish_add_path $HOME/.cargo/bin
fish_add_path $HOME/.local/bin
fish_add_path $HOME/.local/bin/zen/zen
fish_add_path /usr/local/bin
fish_add_path /usr/local/go/bin
fish_add_path $HOME/go/bin

# Antigravity (Added dynamically if present)
if test -d "$HOME/.antigravity/antigravity/bin"
    fish_add_path "$HOME/.antigravity/antigravity/bin"
end

# Google Cloud
if test -d "$HOME/google-cloud-sdk/bin/"
    fish_add_path "$HOME/google-cloud-sdk/bin/"
end

# Fly.io
if test -d "$HOME/.fly/bin/"
    fish_add_path "$HOME/.fly/bin/"
end

# =========================
# Aliases
# =========================
if test -f ~/.config/fish/aliases/common.fish
    source ~/.config/fish/aliases/common.fish
end

# =========================
# Vi key bindings
# =========================
fish_vi_key_bindings

# =========================
# Secrets (Infisical Placeholder)
# =========================
# Note: Previous secrets.fish source removed.
# TODO: Add 'infisical run -- fish' wrapper or export logic here later.

# =========================
# Interactive-only init
# =========================
if status is-interactive
    # Set TTY for GPG pinentry prompts
    set -x GPG_TTY (tty)

    # 1. Initialize mise
    if type -q mise
        mise activate fish --shims | source
    end

    # 2. Initialize Atuin (Fixed: Use 'command' to bypass aliases)
    if type -q atuin
        command atuin init fish | source
    end

    # 3. Starship
    if type -q starship
        starship init fish | source
    end

    # 4. Zoxide
    if type -q zoxide
        zoxide init --cmd cd fish | source
    end
end

# =========================
# Machine-Specific Tweaks
# =========================

{{- /* Mac Mini Specifics */}}
{{- if eq .chezmoi.hostname "Mac-mini" }}
# Starship config path override
set -gx STARSHIP_CONFIG $HOME/.config/starship/starship.toml

# WezTerm background image
set -gx shellBgImagePath "$HOME/.config/wezterm/images/d3Logo.png"

# If in WezTerm, send user-var (fix WEZTERM_PANE name & var usage)
if set -q WEZTERM_PANE
    wezterm cli set-user-var --pane-id $WEZTERM_PANE shellBgImagePath "$shellBgImagePath"
end
{{- end }}

{{- /* Raspberry Pi Specifics */}}
{{- if eq .chezmoi.hostname "raspberrypi" }}
# Placeholder for future Pi tweaks
{{- end }}
